{% block content %}
<div id ="exams-table">
    {% if exams %}
        <table class="table table-hover">
            <thead class="thead thead-dark">
                <tr>
                    <th>Exam code</th>
                    <th>Exam</th>
                    <th>Exam date</th>
                </tr>
            </thead>
            <tbody>
                {% for exam in exams %}
                    <tr class="subject" data-id="{{ exam.exam_id }}" data-title= "{{ exam.exam_title }}">
                        <!-- <td> <input type="checkbox" id="{{ exam.exam_id }}" data-id="{{ exam.exam_id }}" data-title= "{{ exam.exam_title }}" name="{{exam.exam_title}}"></td> -->
                        <td>{{exam.exam_id}}</td>
                        <td>{{exam.exam_title}}</td>
                        <td>{{exam.date}}</td>
                        <!-- <td><button type="button" id="apply-button" class="btn btn-primary open-AddBookDialog" data-toggle="modal" data-target="#apply-modal" data-id="{{ exam.exam_id }}" data-title= "{{ exam.exam_title }}">
                            Apply
                          </button></td> -->
                    </tr>
                {% endfor %}
                <tr>
                  <td colspan="4" align="right"><button type="button" class="btn btn-primary" id="open-ApplyDialog" data-toggle="modal" data-target = "#apply-modal">
                    Apply
                  </button></td>
                </tr>
            </tbody>
        </table>
    {% else %}
        <h4> There are no exams.</h4>
    {% endif %}

    <div class="modal fade" id="apply-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Exam Application</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
             <div id="Application">
               <span id="examscount"></span> exam(s) selected for the current term. Press OK to confirm.
             </div>
          </div>
          <div class="modal-footer">
            <button type="button" id="firstmodal_close_button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <a href=" {% url 'student:index' %} "><button type="submit" class="btn btn-primary" id="OK-button-1" data-dismiss="modal">OK</button></a>
          </div>
        </div>
      </div>
    </div>
</div>
{% endblock%}

{% block javascript %}
      <script>
        var exams = {}
        var count= $('tr.subject').length;

        $("#open-ApplyDialog").click(function(event){
          exams={}
          
          var i=0;
          $('tr.subject').each(function() {
            exams[i] = $(this).data("id")
            i++
          });

          //console.log(JSON.stringify(exams)) 
          $("#examscount").text(count)
        })

         
        $("#OK-button-1").click(function(event){
            //$("#firstmodal_close_button").click()
            exams_string = JSON.stringify(exams)
            //alert(exams_string)
            
            $.ajax({
              url: "{% url 'student:testexamAjax'%}",
              type: 'GET',
              data: {'exams': exams_string},
              success: function(data){
                // $("#Confirmation").html(data)
                // $("#confirmation-modal").modal('show')
              }
            })
        }) 

        $("#confirm-button").click(function(event){
          $.ajax({
            url: "{% url 'student:confirmexamAjax' %}",
            data: {'exam_data': exams_string},
            success: function(data){
              $("#secondmodal_close_button").click()
              $("#confirm-modal").modal('show')
            }
          })
        })
        
        $("#successmodal_close_button").click(function(event){
          location.reload();
          $("#confirm-modal").modal('hide')
        })

      </script>
{% endblock %}